# Database Schema Documentation

## Overview

This document outlines the database schema for the Task Manager application, built on Supabase (PostgreSQL).

## Supabase Setup

- Follow instructions in [Setup Guide](./Setup_Guide.md) for initial Supabase setup.

## Tables

### `auth.users` (Provided by Supabase)

This table is automatically created and managed by Supabase Authentication. We do not create it ourselves, but we link to it from our other tables.

- **id**: `uuid`, Primary Key - The unique identifier for each user.
- **email**: `text`
- ... and other metadata columns managed by Supabase.

### `public.tasks`

Stores the tasks for each user. Each task is linked to a user.

| Column      | Type        | Constraints                                        |
|-------------|-------------|----------------------------------------------------|
| `id`          | `bigint`    | Primary Key, Generated by default as identity      |
| `created_at`  | `timestamptz` | Not Null, Default `now()`                          |
| `title`       | `text`      | Not Null                                           |
| `description` | `text`      | Nullable                                           |
| `status`      | `text`      | Not Null, Default `'todo'`                         |
| `due_date`    | `date`      | Nullable                                           |
| `parent_id`   | `bigint`    | Foreign Key to `public.tasks(id)`, On Delete Cascade |
| `user_id`     | `uuid`      | Not Null, Foreign Key to `auth.users(id)`, On Delete Cascade |

### `public.time_entries`

Stores time tracking entries for each task.

| Column      | Type        | Constraints                                        |
|-------------|-------------|----------------------------------------------------|
| `id`          | `bigint`    | Primary Key, Generated by default as identity      |
| `created_at`  | `timestamptz` | Not Null, Default `now()`                          |
| `start_time`  | `timestamptz` | Not Null                                           |
| `end_time`    | `timestamptz` | Nullable (for timers currently running)            |
| `task_id`     | `bigint`    | Not Null, Foreign Key to `public.tasks(id)`, On Delete Cascade |
| `user_id`     | `uuid`      | Not Null, Foreign Key to `auth.users(id)`, On Delete Cascade |

## Row Level Security (RLS) Policies

RLS is enabled for all tables in the `public` schema to ensure users can only access their own data.

- **`tasks` table policies**: Users can perform `SELECT`, `INSERT`, `UPDATE`, `DELETE` only on rows where `tasks.user_id` matches their own session `auth.uid()`.
- **`time_entries` table policies**: Users can perform `SELECT`, `INSERT`, `UPDATE`, `DELETE` only on rows where `time_entries.user_id` matches their own session `auth.uid()`.

## Relationships

- **Users to Tasks**: One-to-many. A user can have many tasks. Implemented via `tasks.user_id` -> `auth.users.id`.
- **Tasks to Time Entries**: One-to-many. A task can have many time entries. Implemented via `time_entries.task_id` -> `public.tasks.id`.
- **Tasks to Tasks (Subtasks)**: One-to-many. A task can have many subtasks. Implemented via `tasks.parent_id` -> `public.tasks.id`.

---

Complete this document with any changes in schema as the project develops, keeping consistency with the [Backend Guide](./BACKEND_GUIDE.md).
